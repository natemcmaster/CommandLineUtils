<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Dependency Injection </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Dependency Injection ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/natemcmaster/CommandLineUtils/blob/main/docs/docs/advanced/dependency-injection.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.png" alt="CommandLineUtils">
            CommandLineUtils
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="dependency-injection">
<h1 id="dependency-injection">Dependency Injection</h1>

<p>CommandLineUtils allow you to use dependency injection to inject dependencies into command constructors at runtime. This gives you the ability to avoid tight coupling between the commands and the services which they depend on. CommandLineUtils has a standard set of services which are available to inject and also allow you to register and inject your own services.</p>
<h2 id="using-dependency-injection">Using dependency injection</h2>
<p>To inject services into a command constructor, you need to specify the services to be injected as parameters for the <strong>public constructor</strong> of the command.</p>
<p>In the example below, the <code>IConsole</code> implementation is injected into the constructor and stored in a field named <code>_console</code>. Later in the program, this is used to write output to the console:</p>
<pre><code class="lang-csharp" highlight-lines="5,9-12,16">[Command(Name = &quot;di&quot;, Description = &quot;Dependency Injection sample project&quot;)]
[HelpOption]
class Program
{
    private readonly IConsole _console;

    static Task&lt;int&gt; Main(string[] args) =&gt; CommandLineApplication.ExecuteAsync&lt;Program&gt;(args);

    public Program(IConsole console)
    {
        _console = console;
    }

    private int OnExecute()
    {
        _console.WriteLine(&quot;Hello from your first application&quot;);

        return 0;
    }
}
</code></pre><h2 id="using-the-standard-services">Using the standard services</h2>
<p>CommandLineApplication makes a number of services available by default for injecting into your command constructors. There are the standard services which you can inject:</p>
<table>
<thead>
<tr>
<th>Service</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CommandLineApplication</code></td>
<td>Injects the <a class="xref" href="../../api/McMaster.Extensions.CommandLineUtils.CommandLineApplication.html">CommandLineApplication</a> instance.</td>
</tr>
<tr>
<td><code>IConsole</code></td>
<td>Injects the <a class="xref" href="../../api/McMaster.Extensions.CommandLineUtils.IConsole.html">IConsole</a> implementation.</td>
</tr>
<tr>
<td><code>IEnumerable&lt;CommandOption&gt;</code></td>
<td>Injects the definitions for the <a class="xref" href="../../api/McMaster.Extensions.CommandLineUtils.CommandOption.html">options</a> passed to the command.</td>
</tr>
<tr>
<td><code>IEnumerable&lt;CommandArgument&gt;</code></td>
<td>Injects the definitions for the <a class="xref" href="../../api/McMaster.Extensions.CommandLineUtils.CommandArgument.html">arguments</a> passed to the command.</td>
</tr>
<tr>
<td><code>CommandLineContext</code></td>
<td>Injects the <a class="xref" href="../../api/McMaster.Extensions.CommandLineUtils.Abstractions.CommandLineContext.html">CommandLineContext</a> which contains information abount the execution context of the command.</td>
</tr>
<tr>
<td><code>IServiceProvider</code></td>
<td>...</td>
</tr>
<tr>
<td>Command parent type</td>
<td>When using sub-commands, you can inject the type of the parent command into the constructor for a sub-command.</td>
</tr>
</tbody>
</table>
<h2 id="using-your-own-services">Using your own services</h2>
<p>You can register your own services by using the <a class="xref" href="../../api/McMaster.Extensions.CommandLineUtils.Conventions.ConstructorInjectionConvention.html">ConstructorInjectionConvention</a> and making use of the <code>Microsoft.Extensions.DependencyInjection</code> NuGet package to contruct services.</p>
<p>In the example below, we have defined a service named <code>IMyService</code> with a single method named <code>Invoke</code>:</p>
<pre><code class="lang-csharp">interface IMyService
{
    void Invoke();
}
</code></pre>
<p>The implementation of this service is done in <code>MyServiceImplementation</code>, which will write a string to the console. Also, note that an instance of <code>IConsole</code>  is injected into the <code>MyServiceImplementation</code> constructor.</p>
<pre><code class="lang-csharp">class MyServiceImplementation : IMyService
{
    private readonly IConsole _console;

    public MyServiceImplementation(IConsole console)
    {
        _console = console;
    }

    public void Invoke()
    {
        _console.WriteLine(&quot;Hello dependency injection!&quot;);
    }
}
</code></pre>
<p>You can register your own services by creating an instance of <code>ServiceCollection</code> and adding the services to the collection. A service provider is then created by calling the <code>BuildServiceProvider</code> method:</p>
<pre><code class="lang-csharp">var services = new ServiceCollection()
    .AddSingleton&lt;IMyService, MyServiceImplementation&gt;()
    .AddSingleton&lt;IConsole&gt;(PhysicalConsole.Singleton)
    .BuildServiceProvider();
</code></pre>
<div class="NOTE">
<h5>Note</h5>
<p>Take note that standard services which need to be injected into your custom services, such as <code>IConsole</code> which needs to be injected into the <code>MyServiceImplementation</code> constructor, needs to be added to the service collection as well.</p>
</div>
<p>Next, you can call add the constructor injection convention by calling <code>UseConstructorInjection</code>, passing the service provider which was previously created.</p>
<pre><code class="lang-csharp">var app = new CommandLineApplication&lt;Program&gt;();
app.Conventions
    .UseDefaultConventions()
    .UseConstructorInjection(services);
</code></pre>
<p>Below is the full source code for the custom services example. Notice that instance of <code>IMyService</code> will be injected into the <code>Program</code> constructor thanks to the dependency injection.</p>
<pre><code class="lang-csharp" highlight-lines="21-24">[Command(Name = &quot;di&quot;, Description = &quot;Dependency Injection sample project&quot;)]
[HelpOption]
class Program
{
    public static int Main(string[] args)
    {
        var services = new ServiceCollection()
            .AddSingleton&lt;IMyService, MyServiceImplementation&gt;()
            .AddSingleton&lt;IConsole&gt;(PhysicalConsole.Singleton)
            .BuildServiceProvider();

        var app = new CommandLineApplication&lt;Program&gt;();
        app.Conventions
            .UseDefaultConventions()
            .UseConstructorInjection(services);
        return app.Execute(args);
    }

    private readonly IMyService _myService;

    public Program(IMyService myService)
    {
        _myService = myService;
    }

    private void OnExecute()
    {
        _myService.Invoke();
    }
}
</code></pre><h2 id="using-generic-host">Using Generic Host</h2>
<p>See <a class="xref" href="generic-host.html">Integration with Generic Host</a> for details on using Generic Host and dependency injection.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/natemcmaster/CommandLineUtils/blob/main/docs/docs/advanced/dependency-injection.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
           <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
